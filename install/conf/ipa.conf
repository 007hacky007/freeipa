#
# VERSION 2 - DO NOT REMOVE THIS LINE
#
# LoadModule auth_kerb_module modules/mod_auth_kerb.so

ProxyRequests Off
PythonImport ipaserver main_interpreter

# ipa-rewrite.conf is loaded separately

# This is required so the auto-configuration works with Firefox 2+
AddType application/java-archive        jar



<Location "/ipa">
  AuthType Kerberos
  AuthName "Kerberos Login"
  KrbMethodNegotiate on
  KrbMethodK5Passwd off
  KrbServiceName HTTP
  KrbAuthRealms $REALM
  Krb5KeyTab /etc/httpd/conf/ipa.keytab
  KrbSaveCredentials on
  Require valid-user
  ErrorDocument 401 /ipa/errors/unauthorized.html

  SetHandler python-program
  PythonInterpreter main_interpreter
  PythonHandler ipaserver::handler
  PythonDebug Off
  PythonOption SCRIPT_NAME /ipa
  PythonAutoReload Off

</Location>

#<Location "/ipa/xml">
#  SetHandler python-program
#  PythonInterpreter main_interpreter
#  PythonHandler ipaserver::xmlrpc
#  PythonDebug Off
#  PythonOption SCRIPT_NAME /ipa/xml
#  PythonAutoReload Off
#</Location>

#<Location "/ipa/json">
#  SetHandler python-program
#  PythonInterpreter main_interpreter
#  PythonHandler ipaserver::jsonrpc
#  PythonDebug Off
#  PythonOption SCRIPT_NAME /ipa/json
#  PythonAutoReload Off
#</Location>

#<Location "/ipa/ui">
#  SetHandler python-program
#  PythonInterpreter main_interpreter
#  PythonHandler ipaserver::webui
#  PythonDebug Off
#  PythonOption SCRIPT_NAME /ipa/ui
#  PythonAutoReload Off
#</Location>

Alias /ipa-assets/ "/var/cache/ipa/assets/"
<Directory "/var/cache/ipa/assets">
  Allow from all
  AllowOverride None
  # add Indexes to Options to allow browsing
  Options FollowSymLinks
  ExpiresActive On
  ExpiresDefault A31536000
</Directory>


<Location "/ipa/errors">
  SetHandler None
</Location>

<Location "/ipa/config">
  SetHandler None
</Location>

<Location "/ipa/crl">
  SetHandler None
</Location>


# This is where we redirect on failed auth
Alias /ipa/errors "/usr/share/ipa/html"

# For the MIT Windows config files
Alias /ipa/config "/usr/share/ipa/html"

# Do no authentication on the directory that contains error messages
<Directory "/usr/share/ipa/html">
  SetHandler None
  AllowOverride None
  Satisfy Any
  Allow from all
</Directory>


# For CRL publishing
Alias /ipa/crl "/var/lib/pki-ca/publish"

<Directory "/var/lib/pki-ca/publish">
  SetHandler None
  AllowOverride None
  Options Indexes FollowSymLinks
  Satisfy Any
  Allow from all
</Directory>

# Protect our CGIs
<Directory /var/www/cgi-bin>
  AuthType Kerberos
  AuthName "Kerberos Login"
  KrbMethodNegotiate on
  KrbMethodK5Passwd off
  KrbServiceName HTTP
  KrbAuthRealms $REALM
  Krb5KeyTab /etc/httpd/conf/ipa.keytab
  KrbSaveCredentials on
  Require valid-user
  ErrorDocument 401 /ipa/errors/unauthorized.html
</Directory>

# migration related pages
Alias /ipa/migration "/usr/share/ipa/migration"

<Directory "/usr/share/ipa/migration">
    AllowOverride None
    Satisfy Any
    Allow from all

    AddHandler mod_python .py
    PythonHandler mod_python.publisher
</Directory>

#Alias /ipatest "/usr/share/ipa/ipatest"

#<Directory "/usr/share/ipa/ipatest">
#  AuthType Kerberos
#  AuthName "Kerberos Login"
#  KrbMethodNegotiate on
#  KrbMethodK5Passwd off
#  KrbServiceName HTTP
#  KrbAuthRealms $REALM
#  Krb5KeyTab /etc/httpd/conf/ipa.keytab
#  KrbSaveCredentials on
#  Require valid-user
#  ErrorDocument 401 /ipa/errors/unauthorized.html
#
#  SetHandler mod_python
#  PythonHandler test_mod_python
#
#  PythonDebug Off
#
#</Directory>
